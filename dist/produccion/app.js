$.ajaxSettings.cache=!1;var App=function(a){var e=this;return e.appname=a.appname,e.debug=a.debug,e.rutas=a.rutas,e.loader=a.loader||"loader",e.url=a.url||{},e.pre=a.pre||function(){},e.carga=a.carga||["vistas","esquemas","catalogos"],e.carga.forEach(function(o){e[o]=a[o]||{}}),e.init(e),this};App.prototype.consola=function(a,e){if(this.debug)switch(e){case"debug":return void 0;case"error":return void 0;case"info":return void 0;default:return void 0}},App.prototype.init=function(a){app=this,app.consola("Inicializando App","debug");var e=0,o=a.carga.map(function(e){return Object.keys(a[e]).length}).reduce(function(a,e){return e+a},0);this.consola("Total de elementos a cargar: "+o,"debug");var t=function(t,r){app.consola("========== Cargando "+t+" ==========","debug");{var i=Object.keys(r);$("#"+a.loader+" .txt")}i.forEach(function(t){var i=r[t],n=i.match(/{\w+}/g);null!==n&&n.forEach(function(e){var o=e.replace("{","");o=o.replace("}",""),i=i.replace(e,a.url[o])}),app.consola("Cargando "+t+"- desde "+i,"debug"),$.ajax(i).done(function(i){e++;var n=parseInt(e/o*100);$("#"+a.loader+" .porcentaje").html(n+"%"),$("#"+a.loader+" .progress .progress-bar").animate({width:n+"%"},50),r[t]=i,100===n&&(app.consola("========== Finalizando la carga de elementos ==========","debug"),$("#"+a.loader).remove(),Backbone.history.start())}).fail(function(){app.consola(this,"error"),app.consola("Error al cargar "+this.url,"error"),$("#"+a.loader+" .txt").html("Problema cargando... Reintentando..."),$("#"+a.loader+" .porcentaje").html(""),setTimeout(function(){location.reload()},1e4)})})};a.carga.forEach(function(e){t(e,a[e])})},App.prototype.render=function(a,e,o,t,r){var i=this;o=o||{};var n=Handlebars.compile(e),c=n(o),l=e.match(/form/)?!0:!1;isDefined(t)?$(c).appendTo(a):isDefined(r)?$(c).prependTo(a):($(a).html(""),$(a).html(c));var d=$(a).children().data("title");document.title=myApp.appname+" - "+(isDefined(d)?d:"Inicio"),l&&($(".form-validate").parsley(),i.sender.init(".form-validate")),generaTabla(".data-tbl")},App.prototype.sender={"default":{attr:{},key:!1,backbone:!1,model:!1,ajax:!1,serialize:!1,serializeJson:!1,method:"get",action:!1,formData:!1,callback:!1,callbackError:!1},init:function(a){myApp.consola("inicializacion de dataSubmit","debug"),"undefined"!=typeof a?"string"==typeof a?$(a).length&&this.form(a):"object"==typeof a&&this.object(a):myApp.consola("No esta definido el objeto o div para ejecutar","error")},form:function(div){myApp.consola("Seleccion de Form de dataSubmit","debug");var funcion=this,divDom=$(div),attrs=divDom.attrs();divDom.find('input[type="file"]').length>0&&isDefined(divDom.attr("backbone"))===!1&&isDefined(divDom.attr("ajax"))===!1&&(isDefined(divDom.attr("enctype"))?"multipart/form-data"!=divDom.attr("enctype")&&myApp.consola('Hay inputs tipo archivo en el form, no olvides agregar "enctype="multipart/form-data" a tu form para hacer el envio',"debug"):myApp.consola('Hay inputs tipo archivo en el form, no olvides agregar "enctype="multipart/form-data" a tu form para hacer el envio',"debug")),divDom.submit(function(){var dataSubmit={};dataSubmit.attrs=attrs,dataSubmit.callback=isDefined(divDom.attr("callback"))?eval(divDom.attr("callback")):!1,dataSubmit.callbackError=isDefined(divDom.attr("callbackError"))?eval(divDom.attr("callbackError")):!1,dataSubmit.action=isDefined(divDom.attr("action"))?divDom.attr("action"):!1,dataSubmit.key=isDefined(divDom.attr("key"))?divDom.attr("key"):!1,dataSubmit.backbone=isDefined(divDom.attr("backbone")),dataSubmit.model=isDefined(divDom.attr("model"))?isDefined(myModel[divDom.attr("model")])?divDom.attr("model"):!1:!1,dataSubmit.ajax=isDefined(divDom.attr("ajax")),dataSubmit.method=isDefined(divDom.attr("method"))?divDom.attr("method").toLowerCase():"get",dataSubmit.formData=isDefined(divDom.attr("formdata"))?divDom.serializefiles():!1,dataSubmit.serialize=isDefined(divDom.attr("serialize"))?divDom.serialize():!1,$.fn.serializeJSON?dataSubmit.serializeJson=isDefined(divDom.attr("serializejson"))?divDom.serializeJSON():!1:(myApp.consola("SerializeJSON no instalado, recomendamos instalarlo via bower.","debug"),dataSubmit.serializeJson=!1),myApp.consola(dataSubmit,"debug");var form=divDom.parsley().validate();if(form)if(dataSubmit.backbone&&dataSubmit.model)funcion.SendBackbone(dataSubmit);else{if(!dataSubmit.ajax||!dataSubmit.action)return!0;funcion.SendAjax(dataSubmit)}return!1})},object:function(a){myApp.consola("Seleccion de objecto de dataSubmit","debug");var e=this,o=$.extend({},this.default,a);if(myApp.consola(o,"debug"),o.backbone&&o.model)e.SendBackbone(o);else{if(!o.ajax||!o.action)return!1;e.SendAjax(o)}},SendBackbone:function(a){myApp.consola("Evento canalizado a un Backbone");var e;switch(a.method){case"post":a.serializeJson?(e=new myModel[a.model](a.serializeJson),e.save({},{success:function(e,o){myApp.consola("Registro guardado en backbone","debug"),myApp.consola(o,"debug"),a.callback&&a.callback(o,a.attrs)},error:function(e,o){myApp.consola(e,"error"),myApp.consola(o,"error"),a.callbackError&&a.callbackError(o,a.attrs)}})):myApp.consola('Envio de POST sin datos, si el modelo esta definido se usaran los datos "default."',"debug");break;case"get":a.key?(e=new myModel[a.model]({id:a.key}),e.fetch({success:function(e){myApp.consola("Registro encontrado en backbone","debug"),myApp.consola(e.attributes,"debug"),a.callback&&a.callback(e.attributes,a.attrs)},error:function(e,o){myApp.consola(e,"error"),myApp.consola(o,"error"),a.callbackError&&a.callbackError(o,a.attrs)}})):myApp.consola('Envio de GET "key" requerido',"error");break;case"put":a.key?(e=new myModel[a.model]({id:a.key}),e.fetch({success:function(){myApp.consola("Registro encontrado en backbone","debug"),e.set(a.serializeJson),e.save({},{success:function(e,o){myApp.consola("Registro actualizado en backbone","debug"),myApp.consola(o,"debug"),a.callback&&a.callback(o,a.attrs)},error:function(e,o){myApp.consola(e,"error"),myApp.consola(o,"error"),a.callbackError&&a.callbackError(o,a.attrs)}})},error:function(e,o){myApp.consola(e,"error"),myApp.consola(o,"error"),a.callbackError&&a.callbackError(o,a.attrs)}})):myApp.consola('Envio de PUT "key" requerido',"error");break;case"delete":a.key?(e=new myModel[a.model]({id:a.key}),e.destroy({success:function(e,o){myApp.consola("Registro eliminado en backbone","debug"),myApp.consola(o,"debug"),a.callback&&a.callback(o,a.attrs)},error:function(e,o){myApp.consola(e,"error"),myApp.consola(o,"error"),a.callbackError&&a.callbackError(o,a.attrs)}})):myApp.consola('Envio de DELETE "key" requerido',"error")}return!1},SendAjax:function(a){myApp.consola("Evento canalizado a un ajax","debug");var e={type:a.method,url:a.action,dataType:"json"};return a.formData?(e.data=a.formData,e.processData=!1,e.contentType=!1):a.serializeJson?e.data=a.serializeJson:a.serialize&&(e.data=a.serialize),myApp.consola(e,"debug"),myApp.consola("Peticion AJAX: "+e.type,"debug"),myApp.consola("Peticion url: "+e.url,"debug"),isDefined(e.data)&&myApp.consola("Peticion parametros: "+e.data),$.ajax(e).done(function(e){myApp.consola("------Respuesta Exitosa-----","debug"),myApp.consola(e,"debug"),a.callback&&a.callback(e,a.attrs)}).fail(function(e,o){myApp.consola("Fallo en la peticion: "+o,"error"),a.callbackError&&a.callbackError(e,a.attrs)}),!1}};